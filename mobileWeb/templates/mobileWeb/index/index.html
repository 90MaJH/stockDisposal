{% load static %}
<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- 합쳐지고 최소화된 최신 CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

    <!-- 부가적인 테마 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

    <!-- 합쳐지고 최소화된 최신 자바스크립트 -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=2a40b9e58744cbe7d0cb367e51c07eb4"></script>
    <script
            src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>

</head>

<body>
<div id="map" style="width:80%;height:300px; margin:20px auto; border-radius: 10px;"></div>


<div style="width:90%; margin:auto">
    <!-- this row will wrapping foreach-->
    {% for mart in marts %}
        <div class="row">
        <div class="col-xs-5">
            {% with "/mobileWeb/images/"|add:mart.imageFileNo|add:".png" as path %}
                <img src="{% static path %}" style="width:120px; height:120px; margin-top:10px;">
                <br>
                <h3>{{ mart.name }}</h3>
            {% endwith %}
        </div>
        <div class="col-xs-7">
            {% for item in items %}
                {% if mart.id == item.mart_id %}
                    <h4 style="color:mediumpurple;">{{ item.name }}</h4>
                    <h6>{{ item.price }}원</h6>
                    <h6>{{ item.expirationDate|date:"m월d일 까지" }}</h6>
                {% endif %}
            {% endfor %}
        </div>
    {% endfor %}


    </div>
</div>


<script>
    $(document).ready(function () {


        var mapContainer = document.getElementById('map'), // 이미지 지도를 표시할 div
            mapOption = {
                center: new kakao.maps.LatLng(37.586611, 127.029212), // 이미지 지도의 중심좌표
                level: 3, // 이미지 지도의 확대 레벨
                marker: markers // 이미지 지도에 표시할 마커
            };


        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

        // 이미지 지도에 표시할 마커입니다
        // 이미지 지도에 표시할 마커를 아래와 같이 배열로 넣어주면 여러개의 마커를 표시할 수 있습니다
        var markers = [];

        {% for mart in marts %}
            addMarker(new kakao.maps.LatLng({{ mart.xPosition }}, {{ mart.yPosition }}), '{{ mart.name }}');
        {% endfor %}


        function addMarker(position, text) {

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                position: position
            });

            // 마커가 지도 위에 표시되도록 설정합니다
            marker.setMap(map);

            var iwContent = '<div style="padding:5px;"> ' + text + '</div>',
                iwPosition = position; //인포윈도우 표시 위치입니다

// 인포윈도우를 생성합니다
            var infowindow = new kakao.maps.InfoWindow({
                position: iwPosition,
                content: iwContent
            });

// 마커 위에 인포윈도우를 표시합니다. 두번째 파라미터인 marker를 넣어주지 않으면 지도 위에 표시됩니다
            infowindow.open(map, marker);

            // 생성된 마커를 배열에 추가합니다
            markers.push(marker);
        }

        function setMarkers(map) {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(map);
            }
        }

// 마우스 드래그로 지도 이동이 완료되었을 때 마지막 파라미터로 넘어온 함수를 호출하도록 이벤트를 등록합니다
        kakao.maps.event.addListener(map, 'dragend', function () {

            // 지도 중심좌표를 얻어옵니다
            var latlng = map.getCenter();
        });
    });

</script>


</body>

</html>
